{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block content %} 
        
        <ul>
            <li style="background-color: #3a306b;color: #DFDF29;"><a href="">Monitoring</a></li>
            <li><a href="{% url 'detection' %}">Anomalies Detction</a></li>
            <li><a href="{% url 'logout' %}">Logout</a></li>

        </ul> 
        
        
    </div>
    <div class="main_content">
        <div class="header">
          <div class="row">
            <div class="col">
              Overview
            </div>
            <div class="col-md-auto">              
                 <i class="far fa-bell"></i>            
            </div>
            <div class="col col-lg-2">              
              <i class="fa fa-question-circle" aria-hidden="true"></i>       
            </div>
            
          </div>
          
        </div>

        <div class="container  ">
        <div class="btn-group-vertical mt-5 ">
            <a href="{% url 'startcicflowmter'%}"><button type="button" class="btn  " style="
                                                             background-color: #9EA231;
                                                             color: aliceblue;">Start CICFlowMetre</button>
            </a>
             
              
              <form action="{% url 'simple_upload' %}" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mt-3 ml-2">
                  <p class="mb-1">Chose a CSV file pleas !!</p>
                  <input type="file" name="csvfile">
                
               
                </div>

                <div class="form-check ml-3" >
                  
                  <input type="checkbox" value="delete" class="form-check-input" id="delete" name="delete">
                  <label class="form-check-label" for="delete">Delete if exist</label>
                </div>
                <div>                <button type="submit" class="btn mt-3" id="btnuplaod" style="
                                                             background-color: #9EA231;
                                                             color: aliceblue;">Uplaod CSV File</button>
                </div>
                

              
              </form>

              <div class="ml-3">
              {% if messages %}
                {% for message in messages %}
                
                    <strong>{{message|safe}}</strong>
                
            {% endfor %}
            {% endif %}
            {% if uploaded_file_url %}
                <p>File uploaded  <a href="{{ uploaded_file_url }}">{{ uploaded_file_url }}</a></p>
              {% endif %}
              <div>
                <button type="button" name="load_data" id="load_data" class="btn"
                style="
                
                background-color: #9EA231;
                color: rgb(224, 233, 241);"
                >show data</button>
               </div>
            </div>
            </div>
            
            <div class="overflow-auto" style="  
            height:30em;
            width:65em;
            margin-left:1em ;">
              
              
              
              <div id="employee_table">
              </div>
            </div>
            
            
                                                             
        </div> 
        </div>
        

<script>
  


  $(document).ready(function(){
    
 $('#load_data').click(function(){
  $.ajax({
   url:"{{uploaded_file_url}}",
   dataType:"text",
   success:function(data)
   {
    var employee_data = data.split(/\r?\n|\r/);
    var table_data = '<table class="table table-bordered table-striped  ">';
    var t = ""
    for(var count = 0; count<employee_data.length; count++)
    {
     var cell_data = employee_data[count].split(",");
     table_data+='<tbody>'
     for(var cell_count=0; cell_count<cell_data.length; cell_count++)
     {
      
      if(count === 0)
      {
       table_data += '<th style ="position: sticky; top: -1; background-color:aliceblue;">'+cell_data[cell_count]+'</th>';
      }
      else
      {
       table_data += '<td>'+cell_data[cell_count]+'</td>';
      }
      
     }
     table_data+='<tbody>'
    }
    
    table_data += '</table>';
    $('#employee_table').html(table_data);
   }
  });
 });
 
});
</script>
    {%endblock content%}